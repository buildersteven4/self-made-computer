\documentclass[oneside, a4paper]{memoir}

\usepackage{multirow}
\usepackage{longtable}
\usepackage[table]{xcolor}
\usepackage{microtype}
\usepackage[hidelinks]{hyperref}
\usepackage{cleveref}

\begin{document}
% Title
\title{SGPC Programmer's Manual}
\author{Steven Vroom}
\date{November 2016}
\maketitle
\cleardoublepage

\setlength\arrayrulewidth{1pt}
\rowcolors{2}{}{gray!20}

% Front Matter 
\frontmatter
\setcounter{tocdepth}{2}
\tableofcontents
\cleardoublepage

\chapter{About This Manual}
\section{Related Documentation}
\section{Organization}
\section{Conventions}
\section{Acronyms and Abbreviations}

% Main Matter
\mainmatter
\chapter{Overview}
\section{SGPC Architecture Overview}
\section{Registers}
\subsection{User-accessible Registers}
\subsection{Internal Registers}
\section{Instruction Conventions}
\subsection{Instruction Layout}
\subsection{Addressing Modes}
\section{Instruction Set}
\section{Interrupt Model}
\section{Memory Management Model}

\chapter{Register Set}
This chapter describes the registers seperated in four groups based on accessability. however, the internal registers are omitted from this chapter since these are implementation specific.
\section{Foreground Registers}
The foreground registers are the registers all regular instructions can read from and write to. There are eight 8-bit and eight 16-bit foreground registers. These registers are preserved in interrupts.
\begin{table}[h]
\centering
\caption{List of Foreground Registers}
\label{foreground-registers-list}
\begin{tabular}{cclc}
\hiderowcolors
\textbf{ID}  & \textbf{Mnonic} & \textbf{Descriptive Name} & \textbf{Length in bits} \\ \hline
\showrowcolors
0x0 & al & The lower byte of ax  & 8  \\
0x1 & ah & The higher byte of ax & 8  \\
0x2 & bl & The lower byte of bx  & 8  \\
0x3 & bh & The higher byte of bx & 8  \\
0x4 & cl & The lower byte of cx  & 8  \\
0x5 & ch & The higher byte of cx & 8  \\
0x6 & dl & The lower byte of dx  & 8  \\
0x7 & dh & The higher byte of dx & 8  \\
0x8 & ax & The first GPR         & 16 \\
0x9 & bx & The second GPR        & 16 \\
0xA & cx & The third GPR         & 16 \\
0xB & dx & The fourth GPR        & 16 \\
0xC & ex & The fifth GPR         & 16 \\
0xD & tm & Temporary data        & 16 \\
0xE & sp & Stack pointer         & 16 \\
0xF & pc & Program counter       & 16 \\
\end{tabular}
\end{table}
\subsection{General-Purpose Registers (GPRs)}
These registers are meant for computing storage. The first four 16-bit registers are all splitted into two 8-bit registers. So software can directly access the upper and lower byte of these 16-bit registers.
\subsection{Temporary Data Register}
This registers is meant to facilitate call procedures. So it won't be preserved in a function call. However this nothing more than a suggestion to the user, software can use this register as a regular GPR.
\subsection{Stack Pointer Register (SP)}
This register is meant to keep track of the end of the stack. However this nothing more than a suggestion to the user, software can use this register as a regular GPR.
\subsection{Program Counter Register (PC)}
This register holds the address of the next instruction to run. Writing to this registers means jumping to other code.
\section{Background Registers}
Background registers can only accessed with the instructions BSTR and BLD.
\begin{table}[h]
\centering
\caption{List of Background Registers}
\label{background-registers-list}
\begin{tabular}{cclc}
\hiderowcolors
\textbf{ID}  & \textbf{Mnonic} & \textbf{Descriptive Name} & \textbf{Length in bits} \\ \hline
\showrowcolors
0x0 & n/a & Reserved                  & 8  \\
0x1 & n/a & Reserved                  & 8  \\
0x2 & n/a & Reserved                  & 8  \\
0x3 & n/a & Reserved                  & 8  \\
0x4 & n/a & Reserved                  & 8  \\
0x5 & n/a & Reserved                  & 8  \\
0x6 & n/a & Reserved                  & 8  \\
0x7 & n/a & Reserved                  & 8  \\
0x8 & bpc & Program counter backup    & 16 \\
0x9 & bsf & Segments and flags backup & 16 \\
0xA & ipc & Interrupt program counter & 16 \\
0xB & is  & Interrupt segments        & 16 \\
0xC & n/a & Reserved                  & 16 \\
0xD & n/a & Reserved                  & 16 \\
0xE & n/a & Reserved                  & 16 \\
0xF & n/a & Reserved                  & 16 \\
\end{tabular}
\end{table}
\subsection{Backup Registers}
The backup registers are used to backup the state of the CPU. The foreground registers, segment registers and flags register all have their own backup register. However, most backup register aren't background registers. Only the segment registers, program counter register and flags register have directly accessable backup registers. Note that both segment registers and the flag register share one 16-bit backup register.
For more information about the usage of the backup registers see: \autoref{sec:State Preservation}, State Preservation
\subsection{Interrupt Registers}
The Interrupt registers hold the new state the CPU should jump to when an interrupt is triggered. 
\section{Indirect Registers}
\subsection{Flags Register}
\subsection{Section Registers}
\section{Output Registers}

\chapter{Operand Conventions and Addressing Modes}
\section{Operand Conventions}
\subsection{Bit and Byte Ordering}
\subsection{Aligned and Misaligned Memory Access}
\section{Addressing Modes}
\subsection{Not From Memory}
\subsubsection{Register Direct}
\subsubsection{Absolute}
\subsubsection{Register with displacement}
\subsection{From Memory}
\subsubsection{Direct}
\subsubsection{Base Plus Displacement}

\chapter{Instruction Set Summary}
\section{Instruction Types}
\subsection{Move Instructions}
\subsection{Arithimic Instructions}
\subsection{Control Instructions}
\subsection{Reserved Instructions}
\subsection{Artifact Instructions}
\section{Instruction Format}
\subsection{exceptions}

\chapter{Memory Management}
\section{Segments}
\subsection{Base}
\subsection{Limit}
\section{Code Segment (CS)}
\section{Data Segment (DS)}
\section{Segment Switching}
\section{Changing Segments}

\chapter{Interrupts}
\section{Interrupt Enabling/Disabling}
\subsection{Interrupt Enabled Flag}
\subsection{Internal Interrupt Mask}
\subsection{Programmable Interrupt Controller (PIC)}
\section{State Preservation}
\label{sec:State Preservation}
\subsection{Backup}
\subsection{Full Restore}
\subsection{Partial Restore}
\section{Interrupt Service Routine (ISR)}
\subsection{Interrupt Far Jump}
\subsection{Return to Context}
\subsection{Switch Context}

\chapter{I/O Conventions}
\section{Reading Input}
\section{Writing Output}
\subsection{Problem with Interrupts}

\chapter{Instruction Set}
\section*{0x00: MOVZ}
\section*{0x01: MOVNZ}
\section*{0x02: MOVS}
\section*{0x03: MOVNS}
\section*{...}

% Appendix
\appendix
%\backmatter
\chapter{Instruction Set Listings}

\begin{center}
\begin{longtable}{cccccc}
\caption{List of instructions sorted by opcode} 
\label{opcode_sorted_instructions_list} \\
\hiderowcolors
\multicolumn{3}{c}{\textbf{Opcode}} & \multirow{2}{*}{\textbf{Memnonic}} & \multirow{2}{*}{\textbf{Operand A}} & \multirow{2}{*}{\textbf{Operand B}} \\
\textbf{Decimal} & \textbf{Hex} & \textbf{Binary} &  &  &  \\ \hline 
\showrowcolors 
\endhead
0  & 0x00 & 000000 & MOV   & W?    & R?  \\
1  & 0x01 & 000001 & MOV   & W?    & R?  \\
2  & 0x02 & 000010 & MOV   & W?    & R?  \\
3  & 0x03 & 000011 & MOV   & W?    & R?  \\
4  & 0x04 & 000100 & MOV   & W?    & R?  \\
5  & 0x05 & 000101 & MOV   & W?    & R?  \\
6  & 0x06 & 000110 & MOV   & W?    & R?  \\
7  & 0x07 & 000111 & MOV   & W?    & R?  \\
8  & 0x08 & 001000 & MOV   & W?    & R?  \\
9  & 0x09 & 001001 & MOV   & W?    & R?  \\
10 & 0x0A & 001010 & MOV   & W?    & R?  \\
11 & 0x0B & 001011 & MOV   & W?    & R?  \\
12 & 0x0C & 001100 & MOV   & W?    & R?  \\
13 & 0x0D & 001101 & MOV   & W?    & R?  \\
14 & 0x0E & 001110 & MOV   & W?    & R?  \\
15 & 0x0F & 001111 & MOV   & W?    & R?  \\
16 & 0x10 & 010000 & MOV   & W     & R   \\
17 & 0x11 & 010001 & n/a   & n/a   & n/a \\
18 & 0x12 & 010010 & WRI   & \_    & R   \\
19 & 0x13 & 010011 & n/a   & n/a   & n/a \\
20 & 0x14 & 010100 & STRB  & O     & R   \\
21 & 0x15 & 010101 & LDB   & W     & O   \\
22 & 0x16 & 010110 & OUT   & O     & R   \\
23 & 0x17 & 010111 & IN    & W     & O   \\
24 & 0x18 & 011000 & BACK  & \_    & \_  \\
25 & 0x19 & 011001 & FRET  & \_    & \_  \\
26 & 0x1A & 011010 & PRET  & \_    & \_  \\
27 & 0x1B & 011011 & FJMP  & \_    & \_  \\
28 & 0x1C & 011100 & HLT   & \_    & \_  \\
29 & 0x1D & 011101 & NOP   & \_    & \_  \\
30 & 0x1E & 011110 & CMP   & R     & R   \\
31 & 0x1F & 011111 & TEST  & R     & R   \\
32 & 0x20 & 100000 & OR    & R\&W  & R   \\
33 & 0x21 & 100001 & OR    & !R\&W & R   \\
34 & 0x22 & 100010 & OR    & R\&W  & !R  \\
35 & 0x23 & 100011 & OR    & !R\&W & !R  \\
36 & 0x24 & 100100 & AND   & R\&W  & R   \\
37 & 0x25 & 100101 & AND   & !R\&W & R   \\
38 & 0x26 & 100110 & AND   & R\&W  & !R  \\
39 & 0x27 & 100111 & AND   & !R\&W & !R  \\
40 & 0x28 & 101000 & XOR   & R\&W  & R   \\
41 & 0x29 & 101001 & XOR   & !R\&W & R   \\
42 & 0x2A & 101010 & XOR   & R\&W  & !R  \\
43 & 0x2B & 101011 & XOR   & !R\&W & !R  \\
44 & 0x2C & 101100 & ADD   & R\&W  & R   \\
45 & 0x2D & 101101 & ADD   & !R\&W & R   \\
46 & 0x2E & 101110 & ADD   & R\&W  & !R  \\
47 & 0x2F & 101111 & ADD   & !R\&W & !R  \\
48 & 0x30 & 110000 & ADD1  & R\&W  & R   \\
49 & 0x31 & 110001 & ADD1  & !R\&W & R   \\
50 & 0x32 & 110010 & ADD1  & R\&W  & !R  \\
51 & 0x33 & 110011 & ADD1  & !R\&W & !R  \\
52 & 0x34 & 110100 & ADDC  & R\&W  & R   \\
53 & 0x35 & 110101 & ADDC  & !R\&W & R   \\
54 & 0x36 & 110110 & ADDC  & R\&W  & !R  \\
55 & 0x37 & 110111 & ADDC  & !R\&W & !R  \\
56 & 0x38 & 111000 & SHL   & W     & R   \\
57 & 0x39 & 111001 & SHL1  & W     & R   \\
58 & 0x3A & 111010 & RCL   & W     & R   \\
59 & 0x3B & 111011 & ROL   & W     & R   \\
60 & 0x3C & 111100 & SHR   & W     & R   \\
61 & 0x3D & 111101 & SHR1  & W     & R   \\
62 & 0x3E & 111110 & RCR   & W     & R   \\
63 & 0x3F & 111111 & ROR   & W     & R   \\
\end{longtable}
\end{center}

\chapter{Simplified Mnemonics}

\chapter{Common Procedures}

\chapter{Standard Peripherals}
\section{Programmable Interrupt Controller (PIC)}
\section{Keyboard}
\section{Programmable Interrupt Timer (PIT)}
\section{Sound Card}
\section{Graphical Card}
\section{Memory Control Hub (MCH)}
\section{Segements and Out Of Bounds Exception}

\end{document}
